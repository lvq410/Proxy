# 基本用法
这是本项目私有的协议，本质是WebSocket，简称pws，以下场景可以使用本项目：

假设有请求者`A`，服务器`B`。`B`在`3306`端口上对外提供服务。但因为网络问题，`A`无法直接访问到`B`。

而此时如果有一个机器`E`，`A`可以访问到`E`，`E`也能访问到`B`

但 `A`可以访问到`E`的原因是`A`与`E`中间有一层网关或者反向代理，如nginx，并且这层网关不支持纯tcp反向代理，仅支持http/https，**并且你没权限改它让其支持纯tcp反向代理**

> 这是啥场景你想，你细想……

则可以在`E`上部署一个pws代理服务

因为WebSocket的本质是http协议长链，因此可以利用其欺骗中间网关，达成`A`与`B`的纯tcp数据交互

用例：

![pws-proxy](https://user-images.githubusercontent.com/17873791/172582693-e9b6f0b9-e9c9-4241-873f-6dcbfe30a12f.jpg)

> 因为是个私有协议，请求者不可能支持该协议，所以需要在请求者本地再部署一个tcp反向代理，然后配置其出口为pws代理出口，来实现私有代理协议的客户端功能

* ① 请求者与本地tcp反向代理服务建立tcp连接，并发送请求数据
* ② 本地tcp反向代理服务D，将请求者的请求数据包装为WebSocket协议，并在其中加入目标服务的地址信息，然后发送给网关C
* ③ WebSocket格式的消息欺骗网关C成功，网关C将其转发给pws代理服务E
* ④ pws代理服务E收到WebSocket消息后，从中提取出要访问的目标服务地址，与其建立起连接。然后将WebSocket消息解包为请求者A发送的原始请求数据，转发给目标服务B
* ⑤ 目标服务通过④建立的tcp链接，将响应数据传输给pws代理服务E
* ⑥ pws代理服务E将响应数据包装为WebSocket格式，通过③建立的tcp长链，传输给网关C
* ⑦ 网关C将收到的WebSocket消息，通过②建立的tcp长链，传输给D
* ⑧ D收到WebSocket格式的响应消息后，将其解包为B的原始响应数据，然后通过①建立的tcp长链，传输给请求者
* 最终完成A与目标服务B之间的数据交互

整个网络的特殊情况有：
* A需要通过 仅支持http/https协议的 网关才能访问到代理服务

配置代码例：
```
#pws代理服务E
pws:
- 80

#本地tcp反向代理服务D
tcp:
- port: 80
  target: B:3306
  proxy: pws://C:80 
#  proxy: pwss://C:443 #如果网关限制的是仅https协议，则配置成pwss即可
```
